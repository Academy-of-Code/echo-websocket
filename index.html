<div id='titleScreen'>
  <center>
    <h1>Welcome to World Domination!</h1>
    <button class='joinGameButton' onclick='promptJoinRoom()'>Join Game</button>
    <br>
    <br>
    <button class='joinGameButton'>New Game</button>
  </center>
  <div id='game' style='display:none;'>
    <canvas id='gameCanvas' width=300 height=300></canvas>
  </div>
</div>

<script>
	let HOST = 'wss://world-domination-ms.herokuapp.com'
  let ws = new WebSocket(HOST);

  function heartbeat(){
		clearTimeout(this.pingTimeout);
        
		this.pingTimeout = setTimeout(() => {
          this.terminate()
        }, 30000);
	}
      
	ws.onmessage = function incoming(data) {
		var msg = data.data
    if(msg.startsWith('JOINED-')){
    	var roomCode = msg.split('-')[1]
      gameCode = roomCode
      inGame = true
    }
    else{console.log(msg)}
	}
      
	ws.on('open', heartbeat);
  ws.on('ping', heartbeat);
  ws.on('close', function close() {
		clearTimeout(this.pingTimeout);
	})
</script>		
<style>
  .joinGameButton{
    font-size: 20px;
    background: none;
    border: none;
  }
  #gameCanvas{
    position: absolute;
    left: 0px;
    top: 0px;
  }
</style>

<script>
  var gameCode = null;
var inGame = false;

var fps = 15

var playersArr = [];

function requestJoinRoom(code){
	ws.send('JOIN-'+code);
}
function requestNewRoom(){
	ws.send('RES-NEW_ROOM')
}

function promptNewRoom(){
	var isPrivate = window.prompt('Is this room private? y/n');
}
function promptJoinRoom(){
	var roomCodeInput = window.prompt('Enter Room code')
  if(roomCodeInput!==null&&roomCodeInput!==undefined&&roomCodeInput.length===6&&/^\d+$/.test(roomCodeInput) ){
  	ws.send("JOIN-"+roomCodeInput)
  }
}

function requestLogin(username,password){
	ws.send('RES-LOGIN-'+username+'-'+password);
}
function requestLogout(username,password){
	ws.send('RES-LOGOUT');
}

function run(){
	setInterval(function(){
  	if(inGame===true){
    	document.getElementById('titleScreen').style.display = 'none'
    	ws.send('RES-PLAYERS_ARR');
    }
  }, 1000/fps)
}

run()
</script>
